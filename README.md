# Electric Grid Simulation

A smart grid simulation platform for modeling India's high-voltage transmission network. The system loads real infrastructure data from GeoJSON/OpenStreetMap, builds a graph-based electrical grid, places sensors using a sqrt(n) algorithm, injects faults, and identifies faulty segments — all visualized on interactive maps.

---

## Table of Contents

- [Overview](#overview)
- [Project Structure](#project-structure)
- [Prerequisites](#prerequisites)
- [Setup](#setup)
- [Running the Project](#running-the-project)
  - [CLI Simulation](#1-cli-simulation-run_simulationpy)
  - [Streamlit Dashboard](#2-streamlit-dashboard-apppy)
  - [React Dashboard](#3-react-dashboard-dashboard)
- [Data Files](#data-files)
- [Core Modules](#core-modules)
- [Configuration](#configuration)

---

## Overview

The project has three main interfaces:

1. **CLI Simulation** (`run_simulation.py`) — Runs a 5-step simulation pipeline (load grid, energize, place sensors, trigger fault, identify faulty block) and generates HTML map outputs for each step.
2. **Streamlit App** (`app.py`) — An interactive web UI for loading India grid data or custom OSM regions, placing sensors, energizing/de-energizing, and triggering faults with live map visualization.
3. **React Dashboard** (`dashboard/`) — A Vite + React + Leaflet dashboard with real-time client-side simulation, control panels, sensor monitoring, and fault injection via an interactive map.

---

## Project Structure

```
Electric_simulation/
|-- main.py                  # Minimal CLI entry point (modular demo)
|-- run_simulation.py        # Full 5-step simulation pipeline
|-- app.py                   # Streamlit interactive dashboard
|-- export_grid_data.py      # Exports grid data as JSON for the React dashboard
|-- smart_grid_sim.py        # Standalone monolithic simulation script
|-- plot_transmission_map.py # Plotly-based transmission map generator
|-- requirements.txt         # Python dependencies
|
|-- core/                    # Core simulation engine (Python)
|   |-- __init__.py
|   |-- osm_client.py        # Fetches power infrastructure from OpenStreetMap
|   |-- data_processor.py    # Processes raw OSM/GeoJSON data into nodes, poles, lines
|   |-- geojson_loader.py    # Loads and classifies features from GeoJSON files
|   |-- grid_builder.py      # Builds the graph-based grid model from classified data
|   |-- grid_manager.py      # Network construction using pandapower
|   |-- power_flow.py        # Energization, fault triggering, bridge detection
|   |-- sensors.py           # sqrt(n) sensor placement and fault identification
|   |-- visualizer.py        # Plotly map visualization for the Streamlit app
|   |-- sim_visualizer.py    # Folium/HTML map renderer for the CLI simulation
|
|-- dashboard/               # React + Vite + Leaflet frontend
|   |-- src/
|   |   |-- App.jsx
|   |   |-- main.jsx
|   |   |-- index.css
|   |   |-- components/
|   |   |   |-- MapView.jsx      # Leaflet map with grid overlay
|   |   |   |-- ControlPanel.jsx # Grid controls (energize, fault, sensors)
|   |   |   |-- SensorPanel.jsx  # Sensor status monitoring panel
|   |   |   |-- StatusBar.jsx    # Real-time grid status bar
|   |   |-- simulation/
|   |       |-- gridEngine.js    # Client-side grid simulation logic
|   |       |-- sensorEngine.js  # Client-side sensor placement and reading
|   |-- public/
|   |   |-- grid_data.json       # Pre-exported grid data (generated by export_grid_data.py)
|   |-- package.json
|   |-- vite.config.js
|
|-- sim_output/              # Generated HTML maps from run_simulation.py (gitignored)
```

---

## Prerequisites

- **Python 3.9+**
- **Node.js 18+** and **npm** (only for the React dashboard)
- **GeoJSON data file** — The simulation requires a GeoJSON file containing India's transmission infrastructure. This file is not included in the repository due to its size (~280 MB). See [Data Files](#data-files) for details.

---

## Setup

### 1. Clone the Repository

```bash
git clone https://github.com/HEMANT2027/Electric_simulation.git
cd Electric_simulation
```

### 2. Create a Python Virtual Environment

```bash
python -m venv venv
```

Activate the virtual environment:

- **Windows (PowerShell):**
  ```powershell
  .\venv\Scripts\Activate.ps1
  ```
- **Windows (CMD):**
  ```cmd
  venv\Scripts\activate.bat
  ```
- **Linux / macOS:**
  ```bash
  source venv/bin/activate
  ```

### 3. Install Python Dependencies

```bash
pip install -r requirements.txt
```

The required packages are:

| Package      | Purpose                                  |
|-------------|------------------------------------------|
| requests    | Fetching data from OpenStreetMap API      |
| pandapower  | Electrical network modeling               |
| pandas      | Data manipulation                        |
| plotly      | Interactive map visualization (Streamlit) |
| numpy       | Numerical computation                    |
| networkx    | Graph-based grid representation          |

Additional packages installed automatically as dependencies of the above: `folium`, `streamlit` (install separately if using `app.py`).

If you plan to use the Streamlit dashboard, also install:

```bash
pip install streamlit
```

### 4. Set Up the React Dashboard (Optional)

Only needed if you want to run the React-based dashboard.

```bash
cd dashboard
npm install
cd ..
```

---

## Running the Project

### 1. CLI Simulation (`run_simulation.py`)

Runs the full 5-step simulation and outputs interactive HTML maps to `sim_output/`.

```bash
python run_simulation.py
```

**Command-line options:**

| Flag            | Description                                    | Default      |
|----------------|------------------------------------------------|--------------|
| `--max-lines`  | Maximum number of transmission lines to load    | 4200         |
| `--fault-line` | Specific line index to fault (otherwise random) | random       |
| `--geojson`    | Path to the GeoJSON input file                  | `export (1).geojson` |

**Examples:**

```bash
python run_simulation.py --max-lines 2000
python run_simulation.py --fault-line 42
python run_simulation.py --geojson "path/to/custom.geojson"
```

**Output:** Five HTML files in `sim_output/`, one per simulation step:

1. `sim_step_1_grid_loaded.html` — Grid loaded (de-energized)
2. `sim_step_2_energized.html` — Grid energized
3. `sim_step_3_sensors_placed.html` — Sensors placed using sqrt(n) strategy
4. `sim_step_4_fault_triggered.html` — Fault triggered on a line
5. `sim_step_5_fault_identified.html` — Faulty block identified by sensor readings

Open any of these HTML files in a browser to explore the interactive map.

---

### 2. Streamlit Dashboard (`app.py`)

An interactive web application with sidebar controls for loading data, placing sensors, energizing the grid, and injecting faults.

```bash
streamlit run app.py
```

This opens a browser window at `http://localhost:8501`. From the sidebar, you can:

- Choose between India Transmission Grid data or custom OSM bounding box
- Select a region and configure data limits
- Auto-place sensors using the sqrt(n) algorithm or manually select sensor locations
- Energize / de-energize the grid
- Trigger faults on specific lines
- View live sensor status (live vs. dead counts)

---

### 3. React Dashboard (`dashboard/`)

A client-side React + Leaflet dashboard with real-time grid simulation.

**Step 1:** Export grid data from Python to JSON (requires GeoJSON data file):

```bash
python export_grid_data.py
```

This generates `dashboard/public/grid_data.json`.

**Step 2:** Start the development server:

```bash
cd dashboard
npm run dev
```

This opens the dashboard at `http://localhost:5173`. Features include:

- Interactive Leaflet map showing transmission lines, towers, and substations
- Control panel for energizing, triggering faults, and placing sensors
- Real-time sensor monitoring panel
- Fault isolation mode for focused debugging
- Click-to-fault on map lines

---

## Data Files

The simulation requires GeoJSON data files containing India's power transmission infrastructure (towers, lines, substations, poles). These files are **not included** in the repository because they exceed GitHub's file size limits.

| File                              | Size     | Description                                    |
|----------------------------------|----------|------------------------------------------------|
| `IndiaTransmission - Copy.geojson` | ~280 MB  | Full India transmission data (used by `export_grid_data.py`) |
| `export (1).geojson`             | ~52 MB   | Subset of transmission data (used by `run_simulation.py`)    |

You need to obtain these files separately and place them in the project root directory. The data can be exported from [OpenStreetMap](https://www.openstreetmap.org/) using Overpass Turbo queries for power infrastructure.

Alternatively, you can use the Streamlit app's OSM mode to fetch live data for any custom bounding box without needing local GeoJSON files.

---

## Core Modules

The `core/` package contains the simulation engine, organized into focused modules:

| Module              | Responsibility                                                                 |
|--------------------|-------------------------------------------------------------------------------|
| `osm_client.py`    | Queries the Overpass API for power poles, towers, and lines within a bounding box |
| `data_processor.py`| Transforms raw OSM/GeoJSON features into structured node, pole, and line data  |
| `geojson_loader.py`| Parses local GeoJSON files and classifies features by type (line, tower, pole, substation) |
| `grid_builder.py`  | Constructs a NetworkX graph-based grid model from classified geographic data   |
| `grid_manager.py`  | Builds a pandapower network with buses, lines, and external grid connections   |
| `power_flow.py`    | Handles grid energization, fault injection, bridge-fault detection, and status queries |
| `sensors.py`       | Implements the sqrt(n) sensor placement algorithm, sensor reading, and block-based fault identification |
| `visualizer.py`    | Generates Plotly-based interactive maps for the Streamlit dashboard             |
| `sim_visualizer.py`| Renders Folium-based HTML maps for the CLI simulation pipeline                  |

---

## Configuration

Key configuration values are set at the top of each script:

- **`run_simulation.py`**: `GEOJSON_FILE` (input path), `OUTPUT_DIR` (output path), `--max-lines` (CLI arg)
- **`export_grid_data.py`**: `GEOJSON_FILE`, `OUTPUT_FILE`, `BBOX` (Delhi NCR bounding box coordinates)
- **`app.py`**: OSM bounding box defaults (configurable via sidebar), region selector, max towers/lines
- **`dashboard/vite.config.js`**: Vite dev server configuration

---

## License

This project is part of the Apparent Energy research initiative at IIT (ISM) Dhanbad.
